<div class="deal-info-page">
  <dx-toast
    #toastInstance
    [(visible)]="toastVisible"
    [type]="toastType"
    [displayTime]="3000"
    position="top center"
    [width]="300">
    <div *dxTemplate="let data of 'content'">
      <span>{{ toastMessage }}</span>
    </div>
  </dx-toast>
  <app-deal-header [deal]="deal"></app-deal-header>
 
  <div class="timeline-wrapper">
    <app-status-timeline
      [currentStage]="deal?.stage"
      (stageChange)="onStageChange($event)">
    </app-status-timeline>
  </div>
 
  <div class="mobile-tab-bar" *ngIf="isMobile">
    <div class="tab-bar-wrapper">
      <div
        *ngFor="let tab of mobileTabs"
        class="tab"
        [class.active]="mobileSelectedTabId === tab.id"
        (click)="mobileSelectedTabId = tab.id"
      >
        {{ tab.text }}
      </div>
    </div>
  </div>
 
  <div class="content-wrapper">
    <div class="content">
      <div class="desktop-layout">
        <div class="left-column">
          <app-deal-info-card
            [deal]="deal"
            (descriptionChange)="onDescriptionChange($event)"
          ></app-deal-info-card>
        </div>
        <div class="right-column">
          <dx-tabs
            [items]="desktopTabs"
            [selectedIndex]="0"
            (onItemClick)="onDesktopTabSelect($event)"
          ></dx-tabs>
 
          <app-history-timeline
            *ngIf="desktopSelectedTabId === 'history' && dealId" [history]="history"></app-history-timeline>
          <app-doc-upload *ngIf="desktopSelectedTabId === 'documents' && dealId" [dealId]="dealId"></app-doc-upload>
       <app-notes-tab *ngIf="desktopSelectedTabId === 'notes' && dealId"  [dealId]="dealId"></app-notes-tab>
        </div>
      </div>
 
      <div class="mobile-layout" *ngIf="isMobile">
        <div class="section-content">
          <div *ngIf="mobileSelectedTabId === 'deal-stage'" class="tab-section">
            <app-status-timeline
              [currentStage]="deal?.stage"
              (stageChange)="onStageChange($event)"
            ></app-status-timeline>
          </div>
          <div *ngIf="mobileSelectedTabId === 'deal-info'" class="tab-section">
            <app-deal-info-card
              [deal]="deal"
              (descriptionChange)="onDescriptionChange($event)"
            ></app-deal-info-card>
          </div>
          <div *ngIf="mobileSelectedTabId === 'history' && dealId" class="tab-section">
            <app-history-timeline [history]="history"></app-history-timeline>
          </div>
          <div *ngIf="mobileSelectedTabId === 'documents' && dealId" class="tab-section">
            <app-doc-upload [dealId]="dealId"></app-doc-upload>
          </div>
        <div *ngIf="mobileSelectedTabId === 'notes' && dealId" class="tab-section">
  <app-notes-tab [dealId]="dealId"></app-notes-tab>
</div>
        </div>
      </div>
    </div>
  </div>
</div>