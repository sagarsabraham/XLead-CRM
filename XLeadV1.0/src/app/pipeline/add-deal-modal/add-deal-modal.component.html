<dx-popup
  [visible]="isVisible"
  [title]="modalTitle"
  [width]="popupWidth"
  [height]="'auto'"
  [showCloseButton]="true"
  (onHidden)="handleClose()">
  <div *dxTemplate="let data of 'content'" class="popup-content">
    <div class="form-container">
      <app-modal-header title="Deal Information" [showOwner]="true"></app-modal-header>

      <dx-form
        [formData]="newDeal"
        [colCountByScreen]="{ xs: 1, sm: 1, md: 1, lg: 1 }">
 
        <dxi-item dataField="salesperson">
          <dxo-label text="SalesPerson" cssClass="bold-label"></dxo-label>
          <dxi-validation-rule type="required" message="SalesPerson Name is required"></dxi-validation-rule>
        </dxi-item>

        <dxi-item dataField="amount" editorType="dxNumberBox">
          <dxo-label text="Amount" cssClass="bold-label"></dxo-label>
          <dxi-validation-rule type="required" message="Amount is required"></dxi-validation-rule>
        </dxi-item>

        <dxi-item>
          <dxo-label text="Company Name" cssClass="bold-label"></dxo-label>
          <div class="company-name-container">
            <dx-select-box
              id="companySelect"
              [(value)]="newDeal.companyName"
              [dataSource]="filteredCompanies"
              [searchEnabled]="true"
              placeholder="Select or search a company"
              (onValueChanged)="onCompanyChange($event.value)">
            </dx-select-box>
 
            <dx-button
              text="+" 
              type="default"
              (onClick)="openQuickCreateCompanyModal()">
            </dx-button>
          </div>
          <dxi-validation-rule type="required" message="Company Name is required"></dxi-validation-rule>
        </dxi-item>
 
       
        <dxi-item dataField="title">
          <dxo-label text="Deal Name" cssClass="bold-label"></dxo-label>
          <dxi-validation-rule type="required" message="Deal Name is required"></dxi-validation-rule>
        </dxi-item>
     <!-- Replace the existing account dropdown in add-deal-modal.component.html -->
      <dxi-item dataField="account">
        <dxo-label text="Account" cssClass="bold-label"></dxo-label>
        <dx-select-box
          [(value)]="newDeal.account"
          [dataSource]="accounts"
          displayExpr="accountName"
          valueExpr="id"
          [searchEnabled]="true"
          placeholder="Select Account (Optional)">
        </dx-select-box>
      </dxi-item>
            <!-- Replace the existing region dropdown in add-deal-modal.component.html -->
      <dxi-item dataField="region">
        <dxo-label text="Region" cssClass="bold-label"></dxo-label>
        <dx-select-box
          [(value)]="newDeal.region"
          [dataSource]="regions"
          displayExpr="regionName"
          valueExpr="id"
          [searchEnabled]="true"
          placeholder="Select Region">
        </dx-select-box>
        <dxi-validation-rule type="required" message="Region is required"></dxi-validation-rule>
      </dxi-item>
       <dxi-item dataField="contactName">
        <dxo-label text="Contact Name" cssClass="bold-label"></dxo-label>
        <div class="company-name-container">
          <dx-select-box
            [(value)]="newDeal.contactName"
            [dataSource]="filteredContacts"
            [searchEnabled]="true"
            placeholder="Select or search a contact">
          </dx-select-box>
 
          <dx-button
            text="+"
            type="default"
            (onClick)="openQuickCreateContactModal()">
          </dx-button>
        </div>
        <dxi-validation-rule type="required" message="Contact Name is required"></dxi-validation-rule>
      </dxi-item>
 
      <dxi-item dataField="domain">
        <dxo-label text="Domain" cssClass="bold-label"></dxo-label>
        <dx-select-box
          [(value)]="newDeal.domain"
          [dataSource]="domains"
          displayExpr="domainName"
          valueExpr="id"
          [searchEnabled]="true"
          placeholder="Select Domain">
        </dx-select-box>
      </dxi-item>
      <dxi-item dataField="stage">
        <dxo-label text="Stage" cssClass="bold-label"></dxo-label>
        <dx-select-box
          [(value)]="newDeal.stage"
          [dataSource]="dealStages"
          displayExpr="displayName"
          valueExpr="id"
          [searchEnabled]="true"
          placeholder="Select Stage">
        </dx-select-box>
        <dxi-validation-rule type="required" message="Stage is required"></dxi-validation-rule>
      </dxi-item>

      <!-- <dxi-item dataField="stage" editorType="dxSelectBox" [editorOptions]="{ items: stages, placeholder: 'Select Stage' }">
          <dxo-label text="Stage" cssClass="bold-label"></dxo-label>
          <dxi-validation-rule type="required" message="Stage is required"></dxi-validation-rule>
      </dxi-item> -->
        <dxi-item dataField="revenueType">
  <dxo-label text="Revenue Type" cssClass="bold-label"></dxo-label>
  <dx-select-box
    [(value)]="newDeal.revenueType"
    [dataSource]="revenueTypes"
    displayExpr="revenueTypeName"
    valueExpr="id"
    [searchEnabled]="true"
    placeholder="Select Revenue Type">
  </dx-select-box>
  <dxi-validation-rule type="required" message="Revenue Type is required"></dxi-validation-rule>
</dxi-item>

        <dxi-item dataField="department">
          <dxo-label text="DU" cssClass="bold-label"></dxo-label>
          <dx-select-box
            [(value)]="newDeal.department"
            [dataSource]="dus"
            displayExpr="duName"
            valueExpr="id"
            [searchEnabled]="true"
            placeholder="Select DU">
          </dx-select-box>
          <dxi-validation-rule type="required" message="Du is required"></dxi-validation-rule>
        </dxi-item>

        <dxi-item dataField="country">
          <dxo-label text="Country" cssClass="bold-label"></dxo-label>
          <dx-select-box
            [(value)]="newDeal.country"
            [dataSource]="countries"
            displayExpr="countryName"
            valueExpr="id"
            [searchEnabled]="true"
            placeholder="Select Country">
          </dx-select-box>
          <dxi-validation-rule type="required" message="Country is required"></dxi-validation-rule>
        </dxi-item>
        <!-- <dxi-item dataField="department" editorType="dxSelectBox" [editorOptions]="{ items: ['DU-1', 'DU-2', 'DU-3', 'DU-4', 'DU-5', 'DU-6', 'DU-7', 'DU-8'], placeholder: 'Select DU' }">
          <dxo-label text="DU" cssClass="bold-label"></dxo-label>
          <dxi-validation-rule type="required" message="Department is required"></dxi-validation-rule>
        </dxi-item> -->
        <!-- <dxi-item dataField="country" editorType="dxSelectBox" [editorOptions]="{ items: ['India', 'USA', 'Japan', 'South Korea', 'Canada', 'France'], placeholder: 'Select Country' }">
          <dxo-label text="Country" cssClass="bold-label"></dxo-label>
        </dxi-item> -->
        <dxi-item dataField="startDate" editorType="dxDateBox">
          <dxo-label text="Starting Date" cssClass="bold-label"></dxo-label>
          <dxi-validation-rule type="required" message="Date is required"></dxi-validation-rule>
        </dxi-item>
        <dxi-item dataField="closeDate" editorType="dxDateBox">
          <dxo-label text="Closing Date" cssClass="bold-label"></dxo-label>
          <dxi-validation-rule type="required" message="Date is required"></dxi-validation-rule>
        </dxi-item>

        <dxi-item
          dataField="description"
          [editorOptions]="{ placeholder: 'A few words about this deal' }">
          <dxo-label text="Description" cssClass="bold-label"></dxo-label>
          <dxi-validation-rule type="required" message="Description is required"></dxi-validation-rule>
        </dxi-item>

        <dxi-item dataField="probability">
          <dxo-label text="Probability" cssClass="bold-label"></dxo-label>
          <dxi-validation-rule type="required" message="Probability is required"></dxi-validation-rule>
        </dxi-item>
     
      </dx-form>
    </div>
   
      <app-modal-buttons
       [showCustomize]="true"
      [customize]="'Customize Fields'"
      [cancelText]="'Cancel'"
      [saveText]="'Save'"
      (onCancel)="handleClose()"
      (onSave)="handleSubmit()"
      (onCustomize)="openCustomizeFieldModal()">
      </app-modal-buttons>
   
  </div>
</dx-popup>
 
 
<app-form-modal
  *ngIf="isCompanyModalVisible"
  [isVisible]="isCompanyModalVisible"
  [title]="'Add New Company'"
  [formData]="companyData"
  [fields]="companyFields"
  (onClose)="closeQuickCreateCompanyModal()"
  (onSubmit)="addNewCompany($event)">
</app-form-modal>
 
<app-form-modal
  *ngIf="isContactModalVisible"
  [isVisible]="isContactModalVisible"
  [title]="'Add New Contact'"
  [formData]="contactData"
  [fields]="contactFields"
  (onClose)="closeQuickCreateContactModal()"
  (onSubmit)="addNewContact($event)">
</app-form-modal>

<!-- Customize Field Modal -->
<app-form-modal
  *ngIf="isCustomizeFieldModalVisible"
  [isVisible]="isCustomizeFieldModalVisible"
  [title]="'Customize Field'"
  [formData]="customizeFieldFormData"
  [fields]="customizeFieldModalFields"
  (onClose)="closeCustomizeFieldModal()"
  (onSubmit)="addCustomField($event)">
</app-form-modal>